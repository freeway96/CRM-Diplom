<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRM Кабинет | ООО «ХПК»</title>
  <meta name="description" content="Рабочий кабинет CRM ООО «ХПК»." />
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="login.css" />
</head>
<body class="login-page">
  <header class="header login-header">
    <div class="container header-row">
      <a class="brand" href="../index.html" aria-label="ООО ХПК">
        <span class="brand-mark">ХПК</span>
        <span class="brand-text">CRM-система предприятия</span>
      </a>
      <button class="btn btn-line" type="button" data-logout-btn>Выйти</button>
    </div>
  </header>

  <main class="login-main">
    <section class="login-section">
      <div class="login-card">
        <p class="kicker">Рабочая зона</p>
        <h1>Вы вошли в CRM</h1>
        <p class="login-text" data-user-info></p>
      </div>
    </section>
  </main>

  <script>
    (() => {
      const SESSION_KEY = "crm_auth_user";
      const userInfo = document.querySelector("[data-user-info]");
      const logoutBtn = document.querySelector("[data-logout-btn]");
      const raw = sessionStorage.getItem(SESSION_KEY);

      if (!raw) {
        window.location.replace("login.html");
        return;
      }

      try {
        const user = JSON.parse(raw);
        if (userInfo) {
          userInfo.textContent = "Пользователь: " + (user.user || user.login || "Неизвестно");
        }
      } catch (error) {
        sessionStorage.removeItem(SESSION_KEY);
        window.location.replace("login.html");
        return;
      }

      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          sessionStorage.removeItem(SESSION_KEY);
          window.location.replace("login.html");
        });
      }
    })();
  </script>
</body>
</html>
